<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>User Profile</title>
  <link rel="stylesheet" href="profile.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/locale/he.min.js"></script>
  <script>moment.locale('he');</script>
</head>
<body class="with-sidebar">
  <div class="profile-container">
    <div class="profile-header">
      <div class="profile-avatar-container" id="profileAvatarContainer">
        <img
          id="profileImage"
          src="default-avatar.png"
          alt="Profile Picture"
          class="avatar"
          title="Click to change profile image"
        />
        <input type="file" id="imageUpload" accept="image/*" style="display:none" />
      </div>

      <div class="profile-info">
        <div class="profile-top-row" style="display:flex;align-items:center;gap:10px;">
          <h2 id="username">Username</h2>

          <!-- Own profile buttons -->
          <div id="ownProfileControls" style="display:none;gap:10px;">
            <button class="btn edit-profile-btn">Edit profile</button>
            <button class="btn settings-btn" aria-haspopup="dialog" aria-controls="settingsModal" title="Settings">
              <i class="fa fa-cog"></i>
            </button>
          </div>

          <!-- Viewing someone else -->
          <div id="otherProfileControls" style="display:none;gap:10px;">
            <button id="followBtn" class="btn follow-btn">Follow</button>
            <button id="messageBtn" class="btn message-btn">Message</button>
          </div>
        </div>

        <!-- Stats (clickable) -->
        <div class="profile-stats">
          <button class="stat" id="postsCount" type="button" data-stat="posts">0 posts</button>
          <button class="stat" id="followersCount" type="button" data-stat="followers" aria-haspopup="dialog">0 followers</button>
          <button class="stat" id="followingCount" type="button" data-stat="following" aria-haspopup="dialog">0 following</button>
        </div>

        <div class="profile-bio" id="bio">User bio goes here...</div>

        <div class="profile-verified">
          <span>@username</span>
          <i class="fa fa-check-circle verified-icon" aria-label="Verified account"></i>
        </div>
      </div>
    </div>

    <div class="profile-stories"></div>

    <!-- ===== Tabs: Posts vs Groups ===== -->
    <div class="profile-tabs" role="tablist" aria-label="Profile content tabs">
      <button id="profileTabPosts" class="profile-tab-btn active" type="button" aria-controls="panelProfilePosts">
        <i class="fa-solid fa-table-cells"></i><span>Posts</span>
      </button>
      <button id="profileTabGroups" class="profile-tab-btn" type="button" aria-controls="panelGroupPosts">
        <i class="fa-solid fa-users"></i><span>Groups</span>
      </button>
    </div>

    <!-- Panels -->
    <section id="panelProfilePosts" class="profile-tab-panel">
      <div id="profilePostsGrid" class="posts-grid"></div>
    </section>

    <section id="panelGroupPosts" class="profile-tab-panel hidden">
      <div id="groupPostsGrid" class="posts-grid"></div>
    </section>
    <!-- ===== /Tabs ===== -->

    <!-- הגריד הישן נשאר מוסתר, למקרה שיש קוד אחר שתלוי בו -->
    <div id="postsGrid" class="posts-grid" style="display:none;"></div>
  </div>

  <!-- Change profile photo -->
  <div id="profileModal" class="modal confirm-modal hidden" role="dialog" aria-modal="true" aria-labelledby="profileModalTitle">
    <div class="modal-content">
      <h3 id="profileModalTitle">Change Profile Photo</h3>
      <button id="uploadPhotoBtn" class="modal-btn upload-btn">Upload Photo</button>
      <button id="removePhotoBtn" class="modal-btn remove-btn">Remove Current Photo</button>
      <button id="cancelBtn" class="modal-btn cancel-btn">Cancel</button>
    </div>
  </div>

<!-- View post -->
<div id="postModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="postModalTitle">
  <div class="modal-content">
    <div class="modal-image-container">
      <div id="postModalImage" aria-live="polite"></div>
    </div>

    <div class="modal-content-container">
      <div class="post-header">
        <img id="postAuthorAvatar" src="default-avatar.png" alt="Author Avatar" class="post-author-avatar">
        <span id="postAuthorUsername" class="post-author-username">username</span>
        <button class="modal-options-btn" aria-label="Post options">⋯</button>
      </div>

      <div id="postComments" class="post-comments"></div>

      <div class="modal-footer">
        <button id="likeBtn" aria-pressed="false" aria-label="Like">♡</button>
        <span id="likesCount">0 likes</span>

        <form id="commentForm" class="comment-form">
          <input id="commentInput" type="text" placeholder="Add a comment..." required />
          <button type="submit">Post</button>
        </form>
      </div>
    </div>
  </div>

  <button id="closePostModalBtn" class="close-btn" aria-label="Close post modal">&times;</button>
</div>

  <!-- Remove post -->
  <div id="deleteModal" class="modal confirm-modal hidden" role="dialog" aria-modal="true" aria-labelledby="deleteModalTitle">
    <div class="modal-content">
      <h3 id="deleteModalTitle">Are you sure you want to remove this post?</h3>
      <button id="confirmDeleteBtn" class="remove-btn">Remove</button>
      <button id="cancelDeleteBtn" class="cancel-btn">Cancel</button>
    </div>
  </div>

  <!-- Followers / Following modal -->
  <div id="followModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="followModalTitle">
    <div class="modal-content" style="max-width:520px;">
      <div class="modal-header" style="display:flex;align-items:center;justify-content:space-between;">
        <h3 id="followModalTitle">Followers</h3>
        <button id="closeFollowModalBtn" class="close-btn" aria-label="Close">&times;</button>
      </div>

      <div class="modal-body" style="max-height:520px;overflow-y:auto;">
        <div class="search-line" style="display:flex;align-items:center;gap:8px;background:#111;border-radius:10px;padding:8px;">
          <i class="fa-solid fa-magnifying-glass" aria-hidden="true"></i>
          <input type="text" id="followSearchInput" placeholder="Search" style="width:100%;background:transparent;border:none;color:#eee;outline:none;" />
        </div>

        <!-- List goes here -->
        <div id="followList" style="margin-top:10px;"></div>

        <!-- Row template (JS will clone) -->
        <template id="followRowTpl">
          <div class="follow-row" style="display:flex;align-items:center;gap:12px;padding:10px;border-radius:10px;">
            <img class="row-avatar" src="default-avatar.png" alt="" style="width:44px;height:44px;border-radius:50%;object-fit:cover;">
            <div class="row-meta" style="flex:1;min-width:0;">
              <div class="row-username" style="font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">username</div>
              <div class="row-sub" style="font-size:.85rem;color:#a7a7a7;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">Full name or bio</div>
            </div>
            <!-- The action button shows: Follow / Following / Remove -->
            <button class="row-action btn" data-action="follow" style="min-width:96px;">Follow</button>
          </div>
        </template>
      </div>
    </div>
  </div>

  <!-- Create Post modal -->
  <div id="createPostModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="createPostTitle">
    <div class="modal-content" style="max-width:520px;">
      <div class="modal-header">
        <h3 id="createPostTitle">Create a new post</h3>
        <button id="closeCreateModalBtn" class="close-btn" aria-label="Close create post">&times;</button>
      </div>
      <div class="modal-body">
        <div id="createPreview" class="preview" style="display:flex;align-items:center;justify-content:center;min-height:180px;border:1px dashed #2a2a2a;border-radius:12px;background:#0f0f0f;">
          <span style="color:#9b9b9b;">No media selected</span>
        </div>

        <div style="display:flex;gap:10px;margin-top:10px;">
          <button id="pickMediaBtn" class="modal-btn" style="flex:1;">Choose image/video</button>
          <button id="clearMediaBtn" class="cancel-btn" style="flex:1;">Clear</button>
        </div>

        <label style="display:block;font-size:.9rem;margin:10px 0 6px;">Caption</label>
        <textarea id="createCaptionInput" rows="3" placeholder="Write something..." style="resize:vertical;"></textarea>

        <div style="display:flex;gap:10px;margin-top:14px;">
          <button id="createSubmitBtn" class="modal-btn" style="flex:1;" disabled>Post</button>
          <button id="cancelCreateBtn" class="cancel-btn" style="flex:1;">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Sidebar -->
  <div class="sidebar">
    <img src="images/login/instaLogo.png" alt="Instagram Logo" style="width:140px;margin-bottom:40px;" />
    <ul>
      <li><a href="feed.html"><i class="fas fa-house"></i> <span class="link-text">Home</span></a></li>
      <li><a href="#" onclick="openUserSearchModal()"><i class="fas fa-magnifying-glass"></i> <span class="link-text">Search</span></a></li>
      <li><a href="creation-group.html"><i class="fas fa-users"></i> <span class="link-text">Groups</span></a></li>
      <li><a href="profile.html"><i class="far fa-user"></i> <span class="link-text">Profile</span></a></li>
      <li>
        <button id="uploadPostSidebarBtn" class="sidebar-link">
          <i class="far fa-square-plus"></i> <span class="link-text">Create</span>
        </button>
        <!-- file input used by Create modal -->
        <input type="file" id="postImageUpload" accept="image/*,video/*" style="display:none" />
      </li>
    </ul>
  </div>

  <!-- Bottom nav -->
  <nav class="bottom-nav justify-content-evenly align-items-center bg-black text-white py-2 position-fixed bottom-0 w-100 border-top border-dark" style="z-index:999;">
    <a href="feed.html" class="text-white"><i class="fas fa-home fa-lg"></i></a>
    <a href="#"><i class="fas fa-compass fa-lg"></i></a>
    <a href="#"><i class="fas fa-clapperboard fa-lg"></i></a>
    <a href="#"><i class="far fa-square-plus fa-lg"></i></a>
    <a href="#"><i class="fas fa-envelope fa-lg"></i></a>
    <a href="profile.html" class="text-white"><i class="far fa-user fa-lg"></i></a>
  </nav>

  <!-- Settings -->
  <div id="settingsModal" class="modal overlay hidden" role="dialog" aria-modal="true" aria-labelledby="settingsModalTitle">
    <div class="modal-content">
      <div class="modal-header" style="display:flex;align-items:center;justify-content:space-between;gap:12px;">
        <h3 id="settingsModalTitle" style="margin:0;">Settings</h3>
        <button id="closeSettingsBtn" class="close-btn" aria-label="Close settings">&times;</button>
      </div>
      <div class="modal-body" style="display:flex;flex-direction:column;gap:10px;">
        <button id="accountSettingsBtn" class="modal-btn">Account settings</button>
        <button id="privacySettingsBtn" class="modal-btn">Privacy</button>
        <button id="securitySettingsBtn" class="modal-btn">Security</button>
        <hr/>
        <button id="deleteAccountBtn" class="modal-btn danger-btn">Delete my account</button>
        <button id="logoutBtn" class="modal-btn">Log out</button>
      </div>
    </div>
  </div>

  <!-- Edit Profile -->
  <div id="editProfileModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="editProfileTitle">
    <div class="modal-content" style="max-width:420px;">
      <div class="modal-header">
        <h3 id="editProfileTitle">Edit profile</h3>
        <button id="closeEditProfileBtn" class="close-btn" aria-label="Close edit profile">&times;</button>
      </div>
      <div class="modal-body">
        <label style="display:block;font-size:.9rem;margin-bottom:6px;">Name</label>
        <input id="editNameInput" type="text" placeholder="Your name" />
        <label style="display:block;font-size:.9rem;margin:10px 0 6px;">Username</label>
        <input id="editUsernameInput" type="text" placeholder="username" />
        <label style="display:block;font-size:.9rem;margin:10px 0 6px;">Bio</label>
        <textarea id="editBioInput" rows="3" placeholder="Tell people about you" style="resize:vertical;"></textarea>
        <div style="display:flex;gap:10px;margin-top:14px;">
          <button id="saveProfileBtn" class="modal-btn" style="flex:1;">Save changes</button>
          <button id="cancelEditProfileBtn" class="cancel-btn" style="flex:1;">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Account -->
  <div id="deleteAccountModal" class="modal confirm-modal hidden" role="dialog" aria-modal="true" aria-labelledby="deleteAccountTitle">
    <div class="modal-content">
      <h3 id="deleteAccountTitle">Delete Account</h3>
      <p style="margin-top:6px;">This action is <strong>permanent</strong>. Your profile, posts, comments, and followers will be removed.</p>
      <div style="margin-top:10px;">
        <label for="deleteConfirmInput" style="display:block;margin-bottom:6px;">Type <strong>DELETE</strong> to confirm:</label>
        <input id="deleteConfirmInput" type="text" placeholder="DELETE" style="width:100%;padding:8px;border-radius:6px;border:none;">
      </div>
      <div style="margin-top:10px;display:flex;align-items:center;gap:8px;">
        <input id="deleteAcknowledge" type="checkbox" />
        <label for="deleteAcknowledge">I understand that this cannot be undone.</label>
      </div>
      <div style="display:flex;gap:10px;margin-top:16px;">
        <button id="confirmDeleteAccountBtn" class="remove-btn" disabled>Delete account</button>
        <button id="cancelDeleteAccountBtn" class="cancel-btn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Overlay + Search Drawer -->
  <div id="modalOverlay" onclick="closeUserSearchModal()" style="display:none"></div>
  <div id="searchDrawer" class="search-drawer" style="display:none;">
    <div class="search-header">
      <h3>Search</h3>
      <button class="search-close" onclick="closeUserSearchModal()" aria-label="Close">✕</button>
    </div>
    <div class="search-box">
      <i class="fa-solid fa-magnifying-glass"></i>
      <input id="searchInput" type="text" placeholder="Search users or groups…" autocomplete="off" />
      <button id="searchClearBtn" class="clear-btn" aria-label="Clear" title="Clear">×</button>
    </div>
    <div class="search-tabs">
      <button class="tab-btn active" data-type="users" id="tabUsers">Users</button>
      <button class="tab-btn" data-type="groups" id="tabGroups">Groups</button>
    </div>
    <div id="searchResultsList" class="results"></div>
  </div>

  <script src="profile.js"></script>
</body>
</html>
